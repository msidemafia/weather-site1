<!DOCTYPE html>
<html lang="eng-us">

<head>
    <meta charset="utf-8">
    <title>Weather Site</title>
    <link rel="stylesheet" href="assets/css/reset.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/css/bootstrap.min.css" />
    <link rel="stylesheet" href="assets/css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col-md-12" id="weatherInRoselle">
                <h1 id="areaDisplay">New Jersey Weather</h1>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12" id="timeDisplay">
            </div>
        </div>
        <br><br>
        <div class="row">
            <div class="col-md-12" id="imageBox">
                <img id="weatherImg">
            </div>
        </div>
        <br>
        <div id="display">
            <div class="row">
                <div class="col-md-12" id="weatherBox">
                    <p id="weatherP"></p>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12" id="tempBox">
                    <p id="temp"></p>
                </div>
            </div>
        </div>
        <br><br>
        <div class="row">
            <div class="col-md-12">
                <div id="formBlock">
                <form>
                    <input type="text" name="City" placeholder="Enter City" id="cityForm">
                    <input type="submit" value="Submit" id="submitBtn">
                </form>
                </div>
            </div>
        </div>
    </div>
<br><br><br>
        <audio src="assets/audio/Opening.mp3" id="audioPlay" loop="loop" controls>
        </audio>
</body>

<script type="text/javascript" href="assets/javascript/app.js">


    $("#weatherImg").hide();
    $("#display").hide();

    var checkTime = function (i) {
        if (i < 10) {
            i = "0" + i;
        }
        return i;
    }

    var today = new Date();
    var h = today.getHours();
    var m = today.getMinutes();
    var m2 = today.getMinutes();
    m2 = checkTime(m2);
    var time = h + ":" + m2;


    $("#timeDisplay").append(time);


    var totalMinutes = (h * 60) + m;
    console.log(totalMinutes);


$("#submitBtn").on("click", function() {
    $("#weatherImg").show();
    $("#display").show();
    event.preventDefault();
    var citySubmit = $("#cityForm").val();
    var zipUrl = "https://api.weatherbit.io/v2.0/current?city=" + citySubmit + ",NJ&units=I&country=US&key=71a3972b88d0405aa9498ffd466984e0"

  $.ajax({
    url: zipUrl,
    method: "GET"
  }).then(function(response) {
    console.log(response);
    $("#temp").text((response.data[0].temp) + " degrees fahreinheit");
    $("#weatherP").text(response.data[0].weather.description);
    $("#areaDisplay").text("Weather in " + (response.data[0].city_name));

    var sunsetTime = response.data[0].sunset;
    var sunriseTime = response.data[0].sunrise;

    var sunsetSplit = sunsetTime.split(":");
    var sunsetHours = parseInt(sunsetSplit[0]);
    var sunsetMinutes = parseInt(sunsetSplit[1]);
    var totalSunsetMinutes = (sunsetHours * 60) + sunsetMinutes - 300;
    console.log(totalSunsetMinutes);

    var sunriseSplit = sunriseTime.split(":");
    var sunriseHours = parseInt(sunriseSplit[0]);
    var sunriseMinutes = parseInt(sunriseSplit[1]);
    var totalSunriseMinutes = (sunriseHours * 60) + sunriseMinutes - 300;
    console.log(totalSunriseMinutes);



    if (response.data[0].weather.description === "Clear sky") {
        if (totalMinutes <=totalSunriseMinutes || totalMinutes >= totalSunsetMinutes) {
            $("#weatherImg").attr("src", "assets/images/clear-sky-nighttime.jpg");
        }
        else {
            $("#weatherImg").attr("src", "assets/images/clear-sky.jpg");
        }
    }
    else if (response.data[0].weather.description === "Few clouds") {
        if (totalMinutes <=totalSunriseMinutes || totalMinutes >= totalSunsetMinutes) {
            $("#weatherImg").attr("src", "assets/images/few-clouds-nighttime.jpg");
        }
        else {
            $("#weatherImg").attr("src", "assets/images/few-clouds.jpg");
        }
    }
    else if (response.data[0].weather.description === "Overcast clouds") {
        if (totalMinutes <=totalSunriseMinutes || totalMinutes >= totalSunsetMinutes) {
            $("#weatherImg").attr("src", "assets/images/overcast-clouds-nighttime.jpg");
        }
        else {
            $("#weatherImg").attr("src", "assets/images/overcast-clouds.png");
        }
    }
    else if (response.data[0].weather.description === "Scattered clouds") {
        if (totalMinutes <=totalSunriseMinutes || totalMinutes >= totalSunsetMinutes) {
            $("#weatherImg").attr("src", "assets/images/scattered-clouds-nighttime.jpg");
        }
        else {
            $("#weatherImg").attr("src", "assets/images/scattered-clouds.jpg");
        }
    }
  });
});


</script> 
</html>